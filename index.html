<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hostile Aliens</title>
</head>
<body>
    <section style="display: flex; flex-wrap: wrap;"> 
        <!-- Ships inserted here -->
    </section>
    <button>New Game</button>
    <button>Fire</button>
</body>
<script>
    // Build game objects
    class Game {
        constructor() {
            this.isOver = false;
            this.startingShips = [ new Mothership, new DefenceShip, new DefenceShip, new DefenceShip, new DefenceShip, new DefenceShip, new AttackShip, new AttackShip, new AttackShip, new AttackShip, new AttackShip, new AttackShip, new AttackShip, new AttackShip ]
            this.shipsLeft = [];
        }

        setBoard() {
            this.shipsLeft = [...this.startingShips];
            this.updateBoard();
        }

        updateBoard() {
            gameArea.innerHTML = '';
            this.shipsLeft.forEach((item, index) => {
                if (item.isDestroyed) {
                    this.shipsLeft.splice(index, 1);
                } else {
                    gameArea.innerHTML += item.HTML;
                }
            })
            this.checkGameOver();
        }

        checkGameOver() {
            if (this.shipsLeft.length === 0 || this.shipsLeft[0] && this.shipsLeft[0].name !== 'Mother ship') {
                gameArea.innerHTML = `<p>You won! Click 'New Game' to play again</p>`
            }
        }
    }

    class Player {
        selectShip() {
            let count = 0;
            game.shipsLeft.forEach(item => {
                !item.isDestroyed ? count ++ : null;
            })
            return Math.floor(Math.random() * count);
        }

        fire() {
            const shipIndex = this.selectShip();
            game.shipsLeft[shipIndex].takeDamage();
            game.updateBoard();
        }
    }

    class Ship {
        constructor(name, hitPoints, pointsLost) {
            this.name = name;
            this.hitPoints = hitPoints;
            this.pointsLost = pointsLost;
        }

        get isDestroyed() {
            return this.hitPoints <= 0;
        }

        get HTML() {
            return `<div style="margin: 30px; border: 1px solid black;">
                    <h2>${this.name}</h2>
                    <h3>${this.hitPoints}</h3>
                </div>`
        }

        takeDamage() {
            this.hitPoints = this.hitPoints - this.pointsLost;
        }
    }

    class Mothership extends Ship {
        constructor() {
            super()
            this.name = 'Mother ship';
            this.hitPoints = 100;
            this.pointsLost = 9;
        }
    }

    class DefenceShip extends Ship {
        constructor() {
            super()
            this.name = 'Defence ship';
            this.hitPoints = 80;
            this.pointsLost = 10;
        }
    }

    class AttackShip extends Ship {
        constructor() {
            super()
            this.name = 'Attack ship';
            this.hitPoints = 45;
            this.pointsLost = 12;
        }
    }

    // Run game
    const gameArea = document.querySelector('section');
    let game = new Game;
    const player = new Player();
    game.setBoard();
    const buttons = document.querySelectorAll('button');

    buttons[0].addEventListener('click', () => {
        game = new Game()
        game.setBoard();
    })
    buttons[1].addEventListener('click', () => {
        player.fire();
    })
</script>
</html>